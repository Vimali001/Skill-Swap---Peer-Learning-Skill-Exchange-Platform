<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SkillSwap</title>
    <link rel="stylesheet" href="/skillswap/css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/skillswap/index.html" class="logo">ðŸ”„ SkillSwap</a>
            <ul class="nav-links">
                <li><a href="/skillswap/dashboard.html">Dashboard</a></li>
                <li><a href="/skillswap/profile.html">Profile</a></li>
                <li><a href="/skillswap/matches.html">Matches</a></li>
                <li><a href="/skillswap/chatRequests.html">Chat Requests</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1>Welcome, <span id="userName"></span>!</h1>
        <div id="alert-container"></div>

        <div class="dashboard-grid">
            <div class="stat-card">
                <h3 id="matchesCount">0</h3>
                <p>Available Matches</p>
            </div>
            <div class="stat-card">
                <h3 id="chatRequestsCount">0</h3>
                <p>Chat Requests</p>
            </div>
            <div class="stat-card">
                <h3 id="unreadCount">0</h3>
                <p>Unread Notifications</p>
            </div>
        </div>

        <div class="card mt-20">
            <h2 class="card-header">Quick Actions</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                <a href="/skillswap/profile.html" class="btn btn-primary">Update Profile</a>
                <a href="/skillswap/matches.html" class="btn btn-success">Find Matches</a>
                <a href="/skillswap/chatRequests.html" class="btn btn-warning">Chat Requests</a>
            </div>
        </div>

        <div class="card mt-20">
            <h2 class="card-header">Recent Notifications</h2>
            <div id="notifications"></div>
        </div>
    </div>

    <script src="/skillswap/js/api.js"></script>
    <script>
        async function loadDashboard() {
            try {
                const user = await userAPI.getCurrent();
                if (user && user.name) {
                    document.getElementById('userName').textContent = user.name;
                }

                // Load matches count
                const matches = await matchAPI.findMatches();
                document.getElementById('matchesCount').textContent = matches.length || 0;

                // Load chat requests
                const chatRequests = await chatRequestAPI.getPending();
                document.getElementById('chatRequestsCount').textContent = chatRequests.length || 0;

                // Load notifications
                const notifications = await notificationAPI.getAll();
                document.getElementById('unreadCount').textContent = notifications.unreadCount || 0;

                const notificationsContainer = document.getElementById('notifications');
                if (notifications.notifications && notifications.notifications.length > 0) {
                    notificationsContainer.innerHTML = notifications.notifications.slice(0, 5).map(n => `
                        <div class="chat-request-card">
                            <p>${n.message}</p>
                            <small>${formatDate(n.createdAt)}</small>
                        </div>
                    `).join('');
                } else {
                    notificationsContainer.innerHTML = '<p>No notifications</p>';
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                window.location.href = '/skillswap/login.html';
            }
        }

        async function logout() {
            try {
                await userAPI.logout();
                clearAuthInfo();
                window.location.href = '/skillswap/index.html';
            } catch (error) {
                clearAuthInfo();
                window.location.href = '/skillswap/index.html';
            }
        }

        loadDashboard();
    </script>
</body>
</html>

